<div class="body-clock-container">
  <svg width="320" height="320" viewBox="0 0 320 320" class="body-clock-svg">
    <!-- Background circle -->
    <circle 
      [attr.cx]="centerX" 
      [attr.cy]="centerY" 
      [attr.r]="outerRadius" 
      fill="none" 
      stroke="#e5e7eb" 
      stroke-width="2"
      class="clock-background">
    </circle>

    <!-- Hour markers (small ticks) -->
    <g class="hour-markers">
      @for (hour of [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]; track hour) {
        @let angle = (hour * 15) * (Math.PI / 180);
        @let x1 = centerX + Math.cos(angle - Math.PI / 2) * (outerRadius - 5);
        @let y1 = centerY + Math.sin(angle - Math.PI / 2) * (outerRadius - 5);
        @let x2 = centerX + Math.cos(angle - Math.PI / 2) * outerRadius;
        @let y2 = centerY + Math.sin(angle - Math.PI / 2) * outerRadius;
        <line 
          [attr.x1]="x1" 
          [attr.y1]="y1" 
          [attr.x2]="x2" 
          [attr.y2]="y2" 
          stroke="#9ca3af" 
          stroke-width="1">
        </line>
      }
    </g>

    <!-- Activity heatmap ring -->
    <g class="activity-heatmap">
      @for (segment of activitySegments; track segment.hour) {
        <path 
          [attr.d]="createHourSegmentPath(segment.hour, activityRadius)"
          [attr.fill]="segment.color"
          [attr.stroke]="segment.intensity > 0 ? '#ffffff' : 'none'"
          stroke-width="1"
          class="activity-segment"
          (mouseenter)="showTooltip($event, getActivityTooltipText(segment), 'activity')"
          (mouseleave)="hideTooltip()">
        </path>
      }
    </g>

    <!-- Sleep arc -->
    @if (sleepArc) {
      <path 
        [attr.d]="createArcPath(sleepArc.startAngle, sleepArc.endAngle, sleepRadius, sleepArc.largeArcFlag)"
        fill="none"
        stroke="#3b82f6"
        stroke-width="6"
        stroke-linecap="round"
        class="sleep-arc"
        (mouseenter)="showTooltip($event, getSleepTooltipText(), 'sleep')"
        (mouseleave)="hideTooltip()">
      </path>
    }

    <!-- Workout markers -->
    <g class="workout-markers">
      @for (marker of workoutMarkers; track marker.time) {
        <circle 
          [attr.cx]="marker.x" 
          [attr.cy]="marker.y" 
          r="5" 
          fill="#ef4444" 
          stroke="#ffffff" 
          stroke-width="2"
          class="workout-marker"
          (mouseenter)="showTooltip($event, getWorkoutTooltipText(marker), 'workout')"
          (mouseleave)="hideTooltip()">
        </circle>
        <!-- Workout icon (simple dot with type indicator) -->
        <text 
          [attr.x]="marker.x" 
          [attr.y]="marker.y + 1" 
          text-anchor="middle" 
          font-size="7" 
          fill="white" 
          font-weight="bold"
          class="workout-icon"
          pointer-events="none">
          {{ marker.type.charAt(0).toUpperCase() }}
        </text>
      }
    </g>

    <!-- Hour labels -->
    <g class="hour-labels">
      @for (label of hourLabels; track label.hour) {
        <text 
          [attr.x]="label.x" 
          [attr.y]="label.y" 
          text-anchor="middle" 
          font-size="10" 
          fill="#6b7280"
          class="hour-label">
          {{ label.label }}
        </text>
      }
    </g>

    <!-- Center circle -->
    <circle 
      [attr.cx]="centerX" 
      [attr.cy]="centerY" 
      r="8" 
      fill="#374151" 
      class="center-dot">
    </circle>

    <!-- Current time indicator -->
    <g class="current-time">
      <circle 
        [attr.cx]="currentTime.x" 
        [attr.cy]="currentTime.y" 
        r="4" 
        fill="#10b981" 
        class="current-time-marker">
      </circle>
    </g>
  </svg>

  <!-- Tooltip -->
  @if (tooltip.visible) {
    <div 
      class="tooltip"
      [style.left.px]="tooltip.x + 10"
      [style.top.px]="tooltip.y - 10">
      <div class="tooltip-content">
        {{ tooltip.content }}
      </div>
    </div>
  }

  <!-- Legend -->
  <div class="legend">
    <div class="legend-item">
      <div class="legend-color sleep"></div>
      <span>Sleep</span>
    </div>
    <div class="legend-item">
      <div class="legend-color workout"></div>
      <span>Workout</span>
    </div>
    <div class="legend-item">
      <div class="legend-color current-time"></div>
      <span>Current Time</span>
    </div>
    <div class="legend-item">
      <div class="legend-color activity-low"></div>
      <span>Low Activity</span>
    </div>
    <div class="legend-item">
      <div class="legend-color activity-high"></div>
      <span>High Activity</span>
    </div>
  </div>
</div>
